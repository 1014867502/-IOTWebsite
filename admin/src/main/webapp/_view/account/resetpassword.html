<!DOCTYPE html>
<html>
<head>
    #@meta("修改密码")
</head>
<body>

<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-header" data-locale="web_update_psw">修改密码</div>
                <div class="layui-card-body" pad15>
                    <form class="layui-form" lay-filter="myForm">
                        <input type="hidden" name="username" value="#(username)" />

                        <div class="layui-form" lay-filter="">
                            <div class="layui-form-item">
                                <label class="layui-form-label" data-locale="web_new_psw">新密码</label>
                                <div class="layui-input-inline">
                                    <input type="password" name="password" lay-verify="pass" lay-verType="tips" autocomplete="off" id="LAY_password" class="layui-input">
                                </div>
                                <div class="layui-form-mid layui-word-aux" data-locale="web_psw_chars">6到16个字符</div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label" data-locale="web_confirm_new_psw">确认新密码</label>
                                <div class="layui-input-inline">
                                    <input type="password" name="repassword" lay-verify="repass" lay-verType="tips" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                        </div>
                        <div class="layui-form-item layui-layout-admin">
                            <div class="layui-input-block">
                                <div class="layui-footer" style="left: 0;">
                                    <button class="layui-btn" lay-submit="" lay-filter="submitBtn" data-locale="web_item_sumbit">立即提交</button>
                                    <button class="layui-btn layui-btn-primary" id="returnBtn" lay-filter="returnBtn" data-locale="web_item_return">返回</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/assets/lib/jquery-3.4.1.min.js"></script>
<script src="/assets/lib/jquery.i18n.properties-min.js"></script>
<script src="/assets/lib/loadlanguage.js"></script>
<script src="/assets/layuiadmin/layui/layui.js"></script>
<script>
    layui.config({
        base: '/assets/layuiadmin/'
    }).extend({
        index: 'lib/index' //主入口模块
    }).use(['index', 'form'],function(){

        var $ = layui.$
            ,layer = layui.layer
            ,admin = layui.admin
            ,form = layui.form;
        //自定义验证
        form.verify({
            //我们既支持上述函数式的方式，也支持下述数组的形式
            //数组的两个值分别代表：[正则匹配、匹配不符时的提示文字]
            pass: [
                /^[\S]{6,16}$/
                ,$.i18n.prop('web_reg_psw_length_tip')//'密码必须6到16位，且不能出现空格'
            ]

            //确认密码
            ,repass: function(value){
                if(value !== $('#LAY_password').val()){
                    //return '两次密码输入不一致';
                    var msg = $.i18n.prop('web_reg_inconsistent_passwords');
                    return layer.msg(msg);
                }
            }
        });

        //设置密码
        form.on('submit(submitBtn)', function(obj){
            admin.req({
                url:'/account/setpassword',
                data:obj.field,
                done:function (res) {
                    layer.msg($.i18n.prop('web_item_modify_success'));
                }
            })
            return false;
        });
        $('#returnBtn').on('click', function () {
            location.href = "/account";
            return false;
        })
    });
</script>
</body>
</html>