<!DOCTYPE html>
<html lang="en">

<head>
    #@meta("WebGL三维场景")
    <style>
        /*body {*/
        /*    margin: 0;*/
        /*    overflow: hidden;*/
        /*    !* 隐藏body窗口区域滚动条 *!*/
        /*}*/
        html {
            overflow: hidden;
        }
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            color: #fff;
            background: #222;
        }
    </style>
    <!--引入three.js三维引擎-->
    <script src="/assets/lib/3d/three.js"></script>
    <script src="/assets/lib/3d/controls/OrbitControls.js"></script>

</head>

<body>
<!--<div id="container"></div>-->
<div id="div" :style="{width:width+'px',height:height+'px'}"></div>
<script id="vertexShader" type="x-shader/x-vertex">
    varying vec2 texCoord;void main(){texCoord = uv;vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );gl_Position = projectionMatrix * mvPosition;}
  </script>
<script id="fragmentShader" type="x-shader/x-fragment">
    uniform float time;uniform sampler2D texture1;uniform sampler2D texture2;varying vec2 texCoord;uniform float opacity;void main(  ) {vec4 noise = texture2D( texture1, texCoord );vec2 T1 = texCoord + vec2( 1.5, -1.5 ) * time  * 0.01;vec2 T2 = texCoord + vec2( -0.5, 2.0 ) * time *  0.01;T1.x -= noise.r * 2.0;T1.y += noise.g * 4.0;T2.x += noise.g * 0.2;T2.y += noise.b * 0.2;float p = texture2D( texture1, T1 * 2.0 ).a + 0.25;vec4 color = texture2D( texture2, T2 );vec4 temp = color * 2.0 * ( vec4( p, p, p, p ) ) + ( color * color );  gl_FragColor = vec4(temp.rgb,temp.a*opacity);
    }
  </script>
<script>
    /**
     * 创建场景对象Scene
     */
    //var scene = new THREE.Scene();
    /**
     * 创建网格模型
     */
    //var geometry = new THREE.SphereGeometry(60, 40, 40); //创建一个球体几何对象
    //var geometry = new THREE.BoxGeometry(100, 100, 100); //创建一个立方体几何对象Geometry
    // var geometry = new THREE.BufferGeometry(); //声明一个缓冲几何体对象
    //
    // //类型数组创建顶点位置position数据
    // var vertices = new Float32Array([
    //     0, 0, 0, //顶点1坐标
    //     50, 0, 0, //顶点2坐标
    //     0, 100, 0, //顶点3坐标
    //
    //     0, 0, 10, //顶点4坐标
    //     0, 0, 100, //顶点5坐标
    //     50, 0, 10, //顶点6坐标
    // ]);
    // // 创建属性缓冲区对象
    // var attribue = new THREE.BufferAttribute(vertices, 3); //3个为一组，作为一个顶点的xyz坐标
    // // 设置几何体attributes属性的位置position属性
    // geometry.attributes.position = attribue;
    // //类型数组创建顶点颜色color数据
    // var colors = new Float32Array([
    //     0, 0, 0, //顶点1颜色
    //     0, 255, 0, //顶点2颜色
    //     0, 0, 1, //顶点3颜色
    //
    //     1, 1, 0, //顶点4颜色
    //     0, 1, 1, //顶点5颜色
    //     1, 0, 1, //顶点6颜色
    // ]);
    // // 设置几何体attributes属性的颜色color属性
    // geometry.attributes.color = new THREE.BufferAttribute(colors, 3); //3个为一组,表示一个顶点的颜色数据RGB
    //材质对象
    // var material = new THREE.PointsMaterial({
    //     // 使用顶点颜色数据渲染模型，不需要再定义color属性
    //     // color: 0xff0000,
    //     vertexColors: THREE.VertexColors, //以顶点颜色为准
    //     size: 10.0 //点对象像素尺寸
    // });
    // // 点渲染模式  点模型对象Points
    // var points = new THREE.Points(geometry, material); //点模型对象
    // scene.add(points); //点对象添加到场景

    // // 线条渲染模式
    // var material=new THREE.LineBasicMaterial({
    //     vertexColors: THREE.VertexColors, //以顶点颜色为准
    //     size: 10.0 //点对象像素尺寸
    // });//材质对象
    // var line=new THREE.Line(geometry,material);//线条模型对象
    // scene.add(line);//线条对象添加到场景中
    // var camera, controls, scene, renderer, cube, plane;
    //
    // function init() {
    //
    //     var angle = 60;
    //     var width = window.innerWidth;
    //     var height = window.innerHeight;
    //     var aspect = width / height;
    //     var near = .1;
    //     var far = 1000;
    //
    //     scene = new THREE.Scene();
    //     camera = new THREE.PerspectiveCamera(angle, aspect, near, far);
    //
    //     renderer = new THREE.WebGLRenderer();
    //     renderer.setSize(window.innerWidth, window.innerHeight);
    //     renderer.setClearColor(0xf0f0f0);
    //     document.body.appendChild(renderer.domElement);
    //
    //     var planeGeometry = new THREE.PlaneGeometry(10, 10, 12, 12);
    //     var planeMaterial = new THREE.MeshBasicMaterial({
    //         color: 0x888888,
    //         wireframe: true
    //     });
    //     plane = new THREE.Mesh(planeGeometry, planeMaterial);
    //     scene.add(plane);
    //
    //     /**
    //      * 创建扫描网格模型
    //      */
    //     var shape = new THREE.Shape();
    //     /**四条直线绘制一个矩形轮廓*/
    //     shape.moveTo(0,0);//起点
    //     shape.lineTo(0,10);//第2点
    //     shape.lineTo(10,10);//第3点
    //     shape.lineTo(10,0);//第4点
    //     shape.lineTo(0,0);//第5点
    //     /**创建轮廓的扫描轨迹(3D样条曲线)*/
    //     var curve = new THREE.SplineCurve3([
    //         new THREE.Vector3( -10, -50, -50 ),
    //         new THREE.Vector3( 10, 0, 0 ),
    //         new THREE.Vector3( 8, 50, 50 ),
    //         new THREE.Vector3( -5, 0, 100)
    //     ]);
    //     var geometry = new THREE.ExtrudeGeometry(//拉伸造型
    //         shape,//二维轮廓
    //         //拉伸参数
    //         {
    //             bevelEnabled:false,//无倒角
    //             extrudePath:curve,//选择扫描轨迹
    //             steps:50//扫描方向细分数
    //         }
    //     );
    //
    //     var material=new THREE.MeshPhongMaterial({
    //         color:0xff0000,//三角面颜色
    //         side:THREE.DoubleSide//两面可见
    //     });//材质对象
    //     material.wireframe = true;//线条模式渲染(查看细分数)
    //     var mesh=new THREE.Mesh(geometry,material);//旋转网格模型对象
    //     scene.add(mesh);//旋转网格模型添加到场景中
    //
    //     camera.position.z = 10;
    //     controls = new THREE.OrbitControls(camera, renderer.domElement);
    //
    //     window.addEventListener('resize', onWindowResize, false);
    //
    //     //辅助坐标系  参数250表示坐标系大小，可以根据场景大小去设置
    //     var axisHelper = new THREE.AxisHelper(250);
    //     scene.add(axisHelper);
    // }
    //
    // function onWindowResize() {
    //     camera.aspect = window.innerWidth / window.innerHeight;
    //     camera.updateProjectionMatrix();
    //
    //     renderer.setSize(window.innerWidth, window.innerHeight);
    //
    // }
    //
    // function render() {
    //     requestAnimationFrame(render);
    //
    //     renderer.render(scene, camera);
    // }
    //
    //
    // init();
    // render();

    // var geometry = new THREE.Geometry(); //声明一个几何体对象Geometry
    // // 绘制一个U型轮廓
    // var R = 80;//圆弧半径
    // var arc = new THREE.ArcCurve(0, 0, R, 0, Math.PI, true);
    // // 半圆弧的一个端点作为直线的一个端点
    // var line1 = new THREE.LineCurve(new THREE.Vector2(R, 200, 0), new THREE.Vector2(R, 0, 0));
    // var line2 = new THREE.LineCurve(new THREE.Vector2(-R, 0, 0), new THREE.Vector2(-R, 200, 0));
    // // 创建组合曲线对象CurvePath
    // var CurvePath = new THREE.CurvePath();
    // // 把多个线条插入到CurvePath中
    // CurvePath.curves.push(line1, arc, line2);
    // //分段数200
    // var points = CurvePath.getPoints(200);
    // // setFromPoints方法从points中提取数据改变几何体的顶点属性vertices
    // geometry.setFromPoints(points);
    // //材质对象
    // var material = new THREE.LineBasicMaterial({
    //     color: 0x000000
    // });
    // //线条模型对象
    // var line = new THREE.Line(geometry, material);
    // scene.add(line); //线条对象添加到场景中
    //
    // // 辅助坐标系  参数250表示坐标系大小，可以根据场景大小去设置
    // var axisHelper = new THREE.AxisHelper(250);
    // scene.add(axisHelper);
    //
    // // var material = new THREE.MeshLambertMaterial({
    // //     vertexColors: THREE.VertexColors, //以顶点颜色为准
    // //     size: 10.0 //点对象像素尺寸
    // // }); //材质对象Material
    // // var mesh = new THREE.Mesh(geometry, material); //网格模型对象Mesh
    // // scene.add(mesh); //网格模型添加到场景中
    // /**
    //  * 光源设置
    //  */
    //     //点光源
    // var point = new THREE.PointLight(0xffffff);
    // point.position.set(400, 200, 300); //点光源位置
    // scene.add(point); //点光源添加到场景中
    //
    // // 点光源2  位置和point关于原点对称
    // var point2 = new THREE.PointLight(0xffffff);
    // point2.position.set(-400, -200, -300); //点光源位置
    // scene.add(point2); //点光源添加到场景中
    //
    // //环境光
    // var ambient = new THREE.AmbientLight(0x444444);
    // scene.add(ambient);
    // // console.log(scene)
    // // console.log(scene.children)
    // /**
    //  * 相机设置
    //  */
    // var width = window.innerWidth; //窗口宽度
    // var height = window.innerHeight; //窗口高度
    // var k = width / height; //窗口宽高比
    // var s = 200; //三维场景显示范围控制系数，系数越大，显示的范围越大
    // //创建相机对象
    // var camera = new THREE.OrthographicCamera(-s * k, s * k, s, -s, 1, 1000);
    // camera.position.set(100, 300, 150); //设置相机位置
    // camera.lookAt(scene.position); //设置相机方向(指向的场景对象)
    // /**
    //  * 创建渲染器对象
    //  */
    // var renderer = new THREE.WebGLRenderer();
    // renderer.setSize(width, height);//设置渲染区域尺寸
    // renderer.setClearColor(0xb9d3ff, 1); //设置背景颜色
    // document.body.appendChild(renderer.domElement); //body元素中插入canvas对象
    // //执行渲染操作   指定场景、相机作为参数
    // //renderer.render(scene, camera);
    //
    // function render() {
    //     renderer.render(scene,camera);//执行渲染操作
    // }
    // render();
    // var controls = new THREE.OrbitControls(camera,renderer.domElement);//创建控件对象
    // controls.addEventListener('change', render);//监听鼠标、键盘事件

    // let T0 = new Date();//上次时间
    // function render() {
    //     let T1 = new Date();//本次时间
    //     let t = T1-T0;//时间差
    //     T0 = T1;//把本次时间赋值给上次时间
    //     requestAnimationFrame(render);
    //     renderer.render(scene,camera);//执行渲染操作
    //     mesh.rotateY(0.001*t);//旋转角速度0.001弧度每毫秒
    //     mesh.rotateX(0.002*t);
    // }
    // render();

    var scene = new THREE.Scene();
    var textureLoader = new THREE.TextureLoader();
    // var textureBack = textureLoader.load("bg.jpg");
    // scene.background = textureBack;
    var group=new THREE.Group();
    var textureSprite=new THREE.TextureLoader().load("/img/light.png");
    var spriteMaterial=new THREE.SpriteMaterial({map:textureSprite,transparent:true,opacity:0.6,});
    var sprite=new THREE.Sprite(spriteMaterial);
    group.add(sprite);
    sprite.scale.set(245,245,1);
    var box=new THREE.SphereGeometry(100,100,100);
    var texture=textureLoader.load("/img/Earth.png");
    var textureNormal=textureLoader.load("/img/EarthNormal.png");
    var textureSpecular=textureLoader.load("/img/EarthSpec.png");
    var material=new THREE.MeshPhongMaterial({
        map:texture,
        normalMap:textureNormal,
        normalScale:new THREE.Vector2(2.9,2.9),
        specularMap:textureSpecular,
        transparent:true,opacity:0.7,
        wireframe:true,
    });
    console.log(material.normalScale);
    var mesh=new THREE.Mesh(box,material);
    var box2=new THREE.SphereGeometry(100.001,100,100);
    var texture1=textureLoader.load("/img/噪声.png");
    var texture2=textureLoader.load("/img/大气2.png");
    texture1.wrapS=THREE.RepeatWrapping;
    texture1.wrapT=THREE.RepeatWrapping;
    texture2.wrapS=THREE.RepeatWrapping;
    texture2.wrapT=THREE.RepeatWrapping;
    var uniforms={
        time:{value:1},
        texture1:{value:texture1},
        texture2:{value:texture2},
        opacity:{value:0.4},};
    var material2=new THREE.ShaderMaterial({
        uniforms:uniforms,
        vertexShader:document.getElementById("vertexShader").textContent,
        fragmentShader:document.getElementById("fragmentShader").textContent,
        transparent:true,});
    var mesh2=new THREE.Mesh(box2,material2);
    group.add(mesh,mesh2);
    scene.add(group);
    var posTrack=new THREE.KeyframeTrack(".scale",[0,10],[0.01,0.01,0.01,1,1,1]);
    var clip=new THREE.AnimationClip("default",10,[posTrack]);
    var mixer=new THREE.AnimationMixer();
    var AnimationAction=mixer.clipAction(clip,group);
    AnimationAction.loop=THREE.LoopOnce;
    AnimationAction.clampWhenFinished=true;
    AnimationAction.play();
    var directionalLight=new THREE.DirectionalLight(16777215,0.9);
    directionalLight.position.set(400,200,300);
    scene.add(directionalLight);
    var directionalLight2=new THREE.DirectionalLight(16777215,0.9);
    directionalLight2.position.set(-400,-200,-300);
    scene.add(directionalLight2);
    var ambient=new THREE.AmbientLight(16777215,0.6);
    scene.add(ambient);
    var width=window.innerWidth;
    var height=window.innerHeight;
    var k=width/height;var s=100;
    var camera=new THREE.OrthographicCamera(-s*k,s*k,s,-s,1,1000);
    camera.position.set(0,100,200);camera.lookAt(scene.position);
    var renderer=new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(width,height);
    document.getElementById("div").appendChild(renderer.domElement);
    var clock=new THREE.Clock();
    var clock=new THREE.Clock();
    function render(){
        var delta=clock.getDelta();
        uniforms.time.value+=delta;
        mixer.update(delta);
        group.rotation.y-=0.005;
        renderer.render(scene,camera);
        requestAnimationFrame(render)
    }

    // 辅助坐标系  参数250表示坐标系大小，可以根据场景大小去设置
    var axisHelper = new THREE.AxisHelper(250);
    scene.add(axisHelper);

    render();
    var controls=new THREE.OrbitControls(camera);
    window.onresize=function(){
        renderer.setSize(window.innerWidth,window.innerHeight);
        k=window.innerWidth/window.innerHeight;
        camera.left=-s*k;
        camera.right=s*k;
        camera.top=s;
        camera.bottom=-s;
        camera.updateProjectionMatrix()
    };


</script>
</body>
</html>